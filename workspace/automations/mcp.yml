slug: mcp
name: 00_MCP/endpoint
description: MCP JSON-RPC 2.0 endpoint for tool discovery and execution
do:
  - conditions:
      '{{body.method}} == "initialize"':
        - set:
            name: output
            value:
              jsonrpc: '2.0'
              id: '{{body.id}}'
              result:
                protocolVersion: '2025-06-18'
                capabilities:
                  tools: {}
                serverInfo:
                  name: prisme-ai-mcp-server
                  version: '1.0.0'
      '{{body.method}} == "notifications/initialized"':
        - set:
            name: $http
            value:
              status: 200
        - set:
            name: output
            value: ''
      '{{body.method}} == "tools/list"':
        - set:
            name: output
            value:
              jsonrpc: '2.0'
              id: '{{body.id}}'
              result:
                tools: '{{config.mcpTools}}'
      '{{body.method}} == "tools/call"':
        - set:
            name: toolArgs
            value:
              arguments: '{{body.params.arguments}}'
        - conditions:
            '{{body.params.name}} == "activitySearch"':
              - activitySearch:
                  body: '{{toolArgs}}'
                  output: toolResult
            '{{body.params.name}} == "getAutomation"':
              - getAutomation:
                  body: '{{toolArgs}}'
                  output: toolResult
            '{{body.params.name}} == "getWorkspace"':
              - getWorkspace:
                  body: '{{toolArgs}}'
                  output: toolResult
            default:
              - set:
                  name: output
                  value:
                    jsonrpc: '2.0'
                    id: '{{body.id}}'
                    error:
                      code: -32601
                      message: 'Tool not found: {{body.params.name}}'
              - break: {}
        - set:
            name: output
            value:
              jsonrpc: '2.0'
              id: '{{body.id}}'
              result: '{{toolResult}}'
      default:
        - set:
            name: output
            value:
              jsonrpc: '2.0'
              id: '{{body.id}}'
              error:
                code: -32601
                message: 'Method not found: {{body.method}}'
when:
  endpoint: true
output: '{{output}}'

